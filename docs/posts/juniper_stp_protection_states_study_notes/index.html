<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <title>
  Juniper STP Protection States Study Notes · Leegacy System
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Lee Dowdells">
<meta name="description" content="This post will take a quick look into the three types of STP Protection available in Juniper including an example diagram of where to use each.
BPDU Protection:Link to headingThe first and arguably most important protection will prevent unexpected BPDUs from influencing the topology and SPF calulations. When enabled (typically on STP edge ports) BPDU protection will monitor an interface and when it sees a BPDU it will disable that interface to prevent malicous or unitentional network outages.">
<meta name="keywords" content="blog, devops, neteng, juniper">
<meta name="fediverse:creator" content="" />


  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Juniper STP Protection States Study Notes">
  <meta name="twitter:description" content="This post will take a quick look into the three types of STP Protection available in Juniper including an example diagram of where to use each.
BPDU Protection:Link to headingThe first and arguably most important protection will prevent unexpected BPDUs from influencing the topology and SPF calulations. When enabled (typically on STP edge ports) BPDU protection will monitor an interface and when it sees a BPDU it will disable that interface to prevent malicous or unitentional network outages.">

<meta property="og:url" content="http://localhost:1313/posts/juniper_stp_protection_states_study_notes/">
  <meta property="og:site_name" content="Leegacy System">
  <meta property="og:title" content="Juniper STP Protection States Study Notes">
  <meta property="og:description" content="This post will take a quick look into the three types of STP Protection available in Juniper including an example diagram of where to use each.
BPDU Protection:Link to headingThe first and arguably most important protection will prevent unexpected BPDUs from influencing the topology and SPF calulations. When enabled (typically on STP edge ports) BPDU protection will monitor an interface and when it sees a BPDU it will disable that interface to prevent malicous or unitentional network outages.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2019-03-30T19:02:00+00:00">
    <meta property="article:modified_time" content="2019-03-30T19:02:00+00:00">
    <meta property="article:tag" content="Juniper">
    <meta property="article:tag" content="Routing">
    <meta property="article:tag" content="JNCIS-ENT">
    <meta property="article:tag" content="STP">
    <meta property="article:tag" content="L2SEC">




<link rel="canonical" href="http://localhost:1313/posts/juniper_stp_protection_states_study_notes/">


<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.css" media="screen">






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.css" media="screen">
  



 




<link rel="icon" type="image/svg+xml" href="/images/site/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/images/site/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/images/site/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-dark">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="http://localhost:1313/">
      Leegacy System
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/posts/">Blog</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="http://localhost:1313/posts/juniper_stp_protection_states_study_notes/">
              Juniper STP Protection States Study Notes
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2019-03-30T19:02:00Z">
                March 30, 2019
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              3-minute read
            </span>
          </div>
          
          <div class="categories">
  <i class="fa-solid fa-folder" aria-hidden="true"></i>
    <a href="/categories/juniper/">Juniper</a></div>

          <div class="tags">
  <i class="fa-solid fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="/tags/juniper/">Juniper</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/routing/">Routing</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/jncis-ent/">JNCIS-ENT</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/stp/">STP</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/l2sec/">L2SEC</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        <p>This post will take a quick look into the three types of STP Protection available in Juniper including an example diagram of where to use each.</p>
<h4 id="bpdu-protection">
  <strong>BPDU Protection:</strong>
  <a class="heading-link" href="#bpdu-protection">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h4>
<p>The first and arguably most important protection will prevent unexpected BPDUs from influencing the topology and SPF calulations. When enabled (typically on STP edge ports) BPDU protection will monitor an interface and when it sees a BPDU it will disable that interface to prevent malicous or unitentional network outages.</p>
<p>To further explain an edge port is typically a server or end host, which typically wouldn&rsquo;t send BPDUs anyway so the edpe port status gives them the ability to shortcut the SPF process. If a user or attacked was to attached a switch to an edge port they could potentially cause loops.</p>
<p>As mentioned the default action for BPDU protect is to disable the offending interface until a network admin clears the error. The alternative is to havethe disable-timeoute statement is configured and once this timer expires, the port will be unblocked (FACT CHECK NEEDED).</p>
<p>BPDU protection can be used in STP, RSTP, VSTP and MSTP deployments, some key statements for STP configuration are:</p>
<ul>
  <li><i>bpdu-block</i> – Enables BDPU protection on a switch not running spanning tree </li>
  <li><i>bpdu-block-on-edge</i> – Enable BDPU projection on a switch running spanning tree </li>
  <li><i>disable-timeout</i> – Change the timeout of a port being down after BDPU breach </li>
  <li><i>clear error bpdu interface</i> – Manually clear BPDU breach </li>
</ul>
<h4 id="loop-protection">
  <strong>Loop Protection:</strong>
  <a class="heading-link" href="#loop-protection">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h4>
<p>LP is intrusive to the normal operations of STP for the sake of security. On a non-root bridge switch if a designated port changes state to down, the non-designated port would normally transition to designated and come up. With LP enabled this doesn&rsquo;t automatically happen, instead the  switch will alert that a non-designated port is trying to become designated for the admin to allow or disallow. LP should be used on non-designated ports that have a chance of becoming designated or root ports.</p>
<p>If a port that should be receiving BPDUs and is in a loop protection state stops receiving BPDUs, it will go into <strong>loop-inconsistent</strong> until a BPDU is received again.</p>
<h4 id="root-protection">
  <strong>Root Protection:</strong>
  <a class="heading-link" href="#root-protection">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h4>
<p>Protects against an unexpected switch with a higher root priority coming into the topology and taking the designated root bridge role. RP should be enabled on interfaces which should not receive superior BPDUs and not be elected as root ports.</p>
<p>If a breach of RP is detected the offending port will be placed into a <strong>root-prevented STP state (inconsistency state)</strong> and block traffic. Once the superior BPDU stops being received the port automatically transitions back through listening, learning and finally forwarding.</p>
<h4 id="example-topology">
  <strong>Example Topology:</strong>
  <a class="heading-link" href="#example-topology">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h4>
<p>Using the example below I will review which ports from the perspective of switch D should be configured with each protection under Juniper recommendation.</p>
<p><a href="/images/posts/2019/01/capture.png"><img src="/images/posts/2019/05/STP_Protections.png" width="720" ></p>
<p><strong>BPDU Protect:</strong> As mentioned previously edge ports should be configured for BPDU protection. This would result in ports 2, 3 in the example being BPDU protected.</p>
<p><strong>Loop Protect:</strong> As previously mentioned LP should be configured on any port that has a chance of being a root or designated port. For switch 4 the only port that this may happen for is Port 1.</p>
<p><strong>Loop Protect:</strong> As previously mentioned RP should be configured on any port that should not recieve a superior BPDU. In this example again ports 2 and 3 should not recieve any superior BPDUs. (FACT CHECK)</p>
<p>| Protection | Port |
| BPDU | 2,3 |
| Loop | 4 |
| Root | 2,3 |</p>

      </div>


      <footer>
        


        
        
        
        
        

        
        
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
      2018 -
    
    2024
     Lee Dowdells 
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.js"></script>
  

  

  


  
  



  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>

</html>
