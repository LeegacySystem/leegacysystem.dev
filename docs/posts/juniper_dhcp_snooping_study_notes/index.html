<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <title>
  Juniper DHCP Snooping Study Notes · Leegacy System
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Lee Dowdells">
<meta name="description" content="This post will cover DHCP snooping in Junos, starting with the exchange of DHCP packets.
As shown in the diagram above the process of obtaining an IP address through DHCP involves multiple broadcasts to the network segment. This can be abuses by attackers as they can by default see and respond to those broadcast messages just as easily as the DHCP server can. If a rogue DHCP server was to assign a fake IP address it would essentially DOS that end host, or it could forward its traffic while capture in a MITM attack.">
<meta name="keywords" content="blog, devops, neteng, juniper">
<meta name="fediverse:creator" content="" />


  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Juniper DHCP Snooping Study Notes">
  <meta name="twitter:description" content="This post will cover DHCP snooping in Junos, starting with the exchange of DHCP packets.
As shown in the diagram above the process of obtaining an IP address through DHCP involves multiple broadcasts to the network segment. This can be abuses by attackers as they can by default see and respond to those broadcast messages just as easily as the DHCP server can. If a rogue DHCP server was to assign a fake IP address it would essentially DOS that end host, or it could forward its traffic while capture in a MITM attack.">

<meta property="og:url" content="https://www.leegacysystem.dev:1313/posts/juniper_dhcp_snooping_study_notes/">
  <meta property="og:site_name" content="Leegacy System">
  <meta property="og:title" content="Juniper DHCP Snooping Study Notes">
  <meta property="og:description" content="This post will cover DHCP snooping in Junos, starting with the exchange of DHCP packets.
As shown in the diagram above the process of obtaining an IP address through DHCP involves multiple broadcasts to the network segment. This can be abuses by attackers as they can by default see and respond to those broadcast messages just as easily as the DHCP server can. If a rogue DHCP server was to assign a fake IP address it would essentially DOS that end host, or it could forward its traffic while capture in a MITM attack.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2019-03-31T13:30:00+00:00">
    <meta property="article:modified_time" content="2019-03-31T13:30:00+00:00">
    <meta property="article:tag" content="Juniper">
    <meta property="article:tag" content="Routing">
    <meta property="article:tag" content="JNCIS-ENT">
    <meta property="article:tag" content="DHCP">
    <meta property="article:tag" content="L2SEC">




<link rel="canonical" href="https://www.leegacysystem.dev:1313/posts/juniper_dhcp_snooping_study_notes/">


<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.css" media="screen">






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.css" media="screen">
  



 




<link rel="icon" type="image/svg+xml" href="/images/site/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/images/site/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/images/site/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-dark">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="https://www.leegacysystem.dev:1313/">
      Leegacy System
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/posts/">Blog</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="https://www.leegacysystem.dev:1313/posts/juniper_dhcp_snooping_study_notes/">
              Juniper DHCP Snooping Study Notes
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2019-03-31T13:30:00Z">
                March 31, 2019
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              3-minute read
            </span>
          </div>
          
          <div class="categories">
  <i class="fa-solid fa-folder" aria-hidden="true"></i>
    <a href="/categories/juniper/">Juniper</a></div>

          <div class="tags">
  <i class="fa-solid fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="/tags/juniper/">Juniper</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/routing/">Routing</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/jncis-ent/">JNCIS-ENT</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/dhcp/">DHCP</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/l2sec/">L2SEC</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        <p>This post will cover DHCP snooping in Junos, starting with the exchange of DHCP packets.</p>
<p><a href="/images/posts/2019/01/capture.png"><img src="/images/posts/2019/06/DHCP_Exchange.png" width="720" ></p>
<p>As shown in the diagram above the process of obtaining an IP address through DHCP involves multiple broadcasts to the network segment. This can be abuses by attackers as they can by  default see and respond to those broadcast messages just as easily as the DHCP server can. If a rogue DHCP server was to assign a fake IP address it would essentially DOS that end host, or it could forward its traffic while capture in a MITM attack.</p>
<h4 id="dhcp-snooping">
  <strong>DHCP Snooping:</strong>
  <a class="heading-link" href="#dhcp-snooping">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h4>
<p>In comes a DHCP snooping to ruin that attackers day by preventing any rogue DHCP servers from intercepting legitimate traffic. DHCP snooping works by building and maintaining a list of valid IP addresses based on the DHCP packets passing through the switch. The switch will snoop on any DHCP request or acknowledgement packets and update its database based on the lease information. Each database mapping contains the IP address, MAC address and related VLAN.</p>
<p>The default behaviours for Junos is to treat every access port as untrusted and every trunk port as trusted. If you have a DHCP server on a access port you will have to manually configure it as trusted for DHCP to work. Likewise if you have a customer/end user machine as a trunk port for whatever reason you may want to manually set that as untrusted.</p>
<h4 id="dhcp-option-82-relay-agent">
  <strong>DHCP Option 82 (relay agent)</strong>
  <a class="heading-link" href="#dhcp-option-82-relay-agent">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h4>
<p>When enabled if a switch intercepts and snoops a DHCP request packet it will add information to it before sending it to the DHCP server. The server then reads the information and uses it to assign an IP address and returns the DHCPAck back to the client including the option 82 information which is again intercepted by the switch and removed before being passed to the client device. There are three configurable sub options:</p>
<ol>
  <li><i>Circuit-ID:</i> By default contains the interface name, vlan or both. A prefix can also be added which is the hostname of the switch.</li>
  <li><i>Remote-ID:</i> Defaults to the MAC address of the switch but can be configured to be the host name or some string of choice.</li>
  <li><i>Vendor-ID:</i> Defaults to Juniper</li>
</ol>
<p>All DHCP snooping is configured under &ldquo;edit ethernet-switching options secure-access-port. By default DHCP bindings are lost after the switch reboots but a file can be specified for persistent storage of DHCP bindings. The key statements for configuration are:</p>
<ol>
  <li><i>No-dhcp-trusted:</i> Stops the port from recieveing DHCP server traffic (default for access ports)</li>
  <li><i>Dhcp-trust:</i> Allows the port to receive DHCP server traffic (default for trunk ports)</li>
  <li><i>examine-dhcp:</i> enables DHCP snooping on a vlan.</li>
  <li><i>Dhcp-snooping-file:</i> enables persistent storage of bindings.</li>
</ol>
<p>For special use cases perhaps where arp is not supported or has to be disabled a static dhcp binding can be installed into a switchs snooping database.</p>

      </div>


      <footer>
        


        
        
        
        
        

        
        
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    All posts are my own ramblings... sorry study notes.
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.js"></script>
  

  

  


  
  



  

  

  

  
<script defer src='https://static.cloudflareinsights.com/beacon.min.js'
        data-cf-beacon='{"token": "a3e23d0e9f3541179b1ae8f47639e993"}'></script>



  

  

  

  

  

  

  

  

  

  

  
</body>

</html>
